<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Class Calendar</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(to right, #f5f7fa, #c3cfe2);
    padding: 20px;
    margin: 0;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #333;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    font-size: 14px;
  }
  th {
    background-color: #4CAF50;
    color: white;
  }
  td.green { background-color: #c8f7c5; }
  td.red { background-color: #f7c5c5; }
  td:hover {
    background-color: #f0f0f0;
    cursor: pointer;
  }

  /* Subtopic popup */
  #popup {
    display: none;
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.2);
    max-width: 90%;
    width: 400px;
    z-index: 1000;
  }
  #popup h3 {
    margin-bottom: 10px;
  }
  #popup ul {
    list-style: disc;
    margin-left: 20px;
    text-align: left;
  }
  #popup button {
    background: #4CAF50;
    color: white;
    border: none;
    padding: 8px 15px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
  }
  #popup button:hover {
    background: #45a049;
  }
</style>
</head>
<body>

<h1>Weekly Class Calendar</h1>
<table id="calendar">
  <thead>
    <tr>
      <th>Week</th>
      <th>Day</th>
      <th>Time</th>
      <th>Task</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="popup">
  <h3>Subtopics</h3>
  <div id="subtopics"></div>
  <button onclick="closePopup()">Close</button>
</div>

<script>
async function loadCalendar() {
  try {
    const res = await fetch('tasks.json');
    const data = await res.json();
    const tbody = document.querySelector('#calendar tbody');
    tbody.innerHTML = '';

    const dates = Object.keys(data).sort((a,b) => new Date(b) - new Date(a));

    dates.forEach(date => {
      const entry = data[date];
      entry.slots.forEach(slot => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${entry.week}</td>
          <td>${entry.day}</td>
          <td>${slot.time}</td>
          <td class="task ${slot.color || ''}" data-subtopics='${JSON.stringify(slot.subtopics || [])}'>
            ${slot.task}
          </td>
        `;
        tbody.appendChild(tr);
      });
    });

    // make every cell clickable
    document.querySelectorAll('.task').forEach(td => {
      td.addEventListener('click', () => {
        const subs = JSON.parse(td.dataset.subtopics);
        const subDiv = document.getElementById('subtopics');
        if (subs.length > 0) {
          subDiv.innerHTML = '<ul>' + subs.map(s => `<li>${s}</li>`).join('') + '</ul>';
        } else {
          subDiv.innerHTML = '<p><i>No subtopics available</i></p>';
        }
        document.getElementById('popup').style.display = 'block';
      });
    });

  } catch (err) {
    console.error('Error loading tasks.json:', err);
  }
}

function closePopup() {
  document.getElementById('popup').style.display = 'none';
}

// Load when page opens
loadCalendar();
</script>

</body>
</html>
