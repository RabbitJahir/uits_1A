<script>
fetch("tasks.json")
  .then(res => res.json())
  .then(data => {
    const timeSlots = ["8-9", "9-10", "10-11", "11-12", "12-1", "1-2", "2-3", "3-4"];
    const daysOfWeek = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const calendar = document.getElementById("calendar");
    let html = "";

    // Group data by week number
    let weeks = {};
    for (let date in data) {
      const week = data[date].week || "Week 1";
      if (!weeks[week]) weeks[week] = [];
      weeks[week].push({ date, day: data[date].day, slots: data[date].slots });
    }

    // Sort by week order
    const sortedWeeks = Object.keys(weeks).sort((a,b) => {
      const na = parseInt(a.replace("Week","").trim());
      const nb = parseInt(b.replace("Week","").trim());
      return na - nb;
    });

    sortedWeeks.forEach(week => {
      html += `<tr><th colspan="${timeSlots.length + 1}" style="background:#e9ecef">${week}</th></tr>`;
      html += "<tr><th>Day</th>";
      timeSlots.forEach(slot => html += `<th>${slot}</th>`);
      html += "</tr>";

      // Sort days within week
      weeks[week].sort((a, b) => daysOfWeek.indexOf(a.day) - daysOfWeek.indexOf(b.day));

      weeks[week].forEach(dayObj => {
        html += `<tr><td><b>${dayObj.day}</b></td>`;
        
        timeSlots.forEach(slotTime => {
          // Find matching slot
          const matchingSlot = dayObj.slots.find(s => s.time.startsWith(slotTime));
          if (matchingSlot) {
            let colorStyle = matchingSlot.color ? `background:${matchingSlot.color};color:white;border-radius:4px;` : "background:#e0f7fa;";
            html += `<td style="${colorStyle}">${matchingSlot.time}: ${matchingSlot.task}</td>`;
          } else {
            html += `<td></td>`;
          }
        });

        html += "</tr>";
      });
    });

    calendar.innerHTML = html;
  })
  .catch(err => console.error("Error loading tasks:", err));
</script>
